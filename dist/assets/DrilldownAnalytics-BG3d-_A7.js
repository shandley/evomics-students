import{j as t}from"./index-CaREKPZR.js";import{r as u,b as m,i as g,C as j,X as y,Y as b,T as p,B as v}from"./charts-9IbAAKVB.js";import"./react-vendor-DJG_os-6.js";const A=({profiles:x,workshops:h})=>{const[r,N]=u.useState(null),[l,w]=u.useState("all"),o=u.useMemo(()=>{const i=l==="all"?x:x.filter(n=>n.participations[l]?.length>0),s={};i.forEach(n=>{const e=n.student.country;s[e]||(s[e]={students:0,institutions:new Set,workshopBreakdown:{}}),s[e].students++,s[e].institutions.add(n.student.institution),Object.keys(n.participations).forEach(a=>{n.participations[a].length>0&&(s[e].workshopBreakdown[a]=(s[e].workshopBreakdown[a]||0)+1)})});const d=Object.entries(s).map(([n,e])=>({country:n,students:e.students,institutions:e.institutions.size,diversity:(e.institutions.size/e.students*100).toFixed(1)})).sort((n,e)=>e.students-n.students).slice(0,15);let c=[];if(r){const n={};i.filter(e=>e.student.country===r).forEach(e=>{n[e.student.institution]=(n[e.student.institution]||0)+1}),c=Object.entries(n).map(([e,a])=>({institution:e,count:a})).sort((e,a)=>a.count-e.count).slice(0,10)}const f=Object.entries(i.reduce((n,e)=>{const a=`${e.student.institution} (${e.student.country})`;return n[a]=(n[a]||0)+1,n},{})).map(([n,e])=>({institution:n,count:e})).sort((n,e)=>e.count-n.count).slice(0,15);return{topCountries:d,institutionStats:c,topInstitutions:f,countryStats:s}},[x,l,r]);return t.jsxs("div",{className:"space-y-6",children:[t.jsx("div",{className:"bg-white rounded-lg border border-gray-200 p-4 shadow-sm",children:t.jsxs("div",{className:"flex flex-wrap items-center gap-4",children:[t.jsxs("div",{children:[t.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Workshop Filter"}),t.jsxs("select",{value:l,onChange:i=>w(i.target.value),className:"px-3 py-2 border border-gray-300 rounded-lg text-sm focus:ring-2 focus:ring-primary-500 focus:border-primary-500",children:[t.jsx("option",{value:"all",children:"All Workshops"}),Object.entries(h).map(([i,s])=>t.jsx("option",{value:i,children:s.shortName},i))]})]}),r&&t.jsxs("div",{children:[t.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Selected Country"}),t.jsxs("div",{className:"flex items-center gap-2",children:[t.jsx("span",{className:"px-3 py-2 bg-blue-100 text-blue-800 rounded-lg text-sm font-medium",children:r}),t.jsx("button",{onClick:()=>N(null),className:"px-2 py-1 text-xs text-gray-500 hover:text-gray-700",children:"Clear"})]})]})]})}),t.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[t.jsxs("div",{className:"bg-white rounded-lg border border-gray-200 p-6 shadow-sm",children:[t.jsxs("h3",{className:"text-lg font-semibold text-gray-900 mb-4",children:["Top Countries by Student Count",l!=="all"&&` (${h[l]?.shortName})`]}),t.jsx("div",{className:"h-80",children:t.jsx(m,{width:"100%",height:"100%",children:t.jsxs(g,{data:o.topCountries,children:[t.jsx(j,{strokeDasharray:"3 3"}),t.jsx(y,{dataKey:"country",angle:-45,textAnchor:"end",height:100,fontSize:10}),t.jsx(b,{}),t.jsx(p,{content:({active:i,payload:s,label:d})=>{if(i&&s&&s.length){const c=s[0].payload;return t.jsxs("div",{className:"bg-white p-3 border border-gray-200 rounded-lg shadow-lg",children:[t.jsx("p",{className:"font-medium text-gray-900",children:d}),t.jsxs("p",{className:"text-sm text-gray-600",children:["Students: ",c.students]}),t.jsxs("p",{className:"text-sm text-gray-600",children:["Institutions: ",c.institutions]}),t.jsxs("p",{className:"text-sm text-gray-600",children:["Diversity: ",c.diversity,"%"]}),t.jsx("p",{className:"text-xs text-blue-600 mt-1 cursor-pointer",children:"Click bar to drill down â†’"})]})}return null}}),t.jsx(v,{dataKey:"students",fill:"#3b82f6",onClick:i=>N(i.country),style:{cursor:"pointer"}})]})})}),t.jsx("p",{className:"text-sm text-gray-600 mt-2",children:"Click on any country bar to see institutional breakdown below."})]}),t.jsxs("div",{className:"bg-white rounded-lg border border-gray-200 p-6 shadow-sm",children:[t.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-4",children:r?`Institutions in ${r}`:"Select a country to view institutions"}),r?t.jsx("div",{className:"h-80",children:t.jsx(m,{width:"100%",height:"100%",children:t.jsxs(g,{data:o.institutionStats,children:[t.jsx(j,{strokeDasharray:"3 3"}),t.jsx(y,{dataKey:"institution",angle:-45,textAnchor:"end",height:100,fontSize:10}),t.jsx(b,{}),t.jsx(p,{content:({active:i,payload:s,label:d})=>i&&s&&s.length?t.jsxs("div",{className:"bg-white p-3 border border-gray-200 rounded-lg shadow-lg max-w-xs",children:[t.jsx("p",{className:"font-medium text-gray-900 text-sm",children:d}),t.jsxs("p",{className:"text-sm text-gray-600",children:["Students: ",s[0].value]})]}):null}),t.jsx(v,{dataKey:"count",fill:"#9333ea"})]})})}):t.jsx("div",{className:"h-80 flex items-center justify-center text-gray-500",children:t.jsxs("div",{className:"text-center",children:[t.jsx("svg",{className:"w-16 h-16 mx-auto mb-4 text-gray-300",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:t.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:1,d:"M19 21V5a2 2 0 00-2-2H7a2 2 0 00-2 2v16m14 0h2m-2 0h-5m-9 0H3m2 0h5M9 7h1m-1 4h1m4-4h1m-1 4h1m-5 10v-5a1 1 0 011-1h2a1 1 0 011 1v5m-4 0h4"})}),t.jsx("p",{children:"Click on a country above to see institutional breakdown"})]})})]})]}),t.jsxs("div",{className:"bg-white rounded-lg border border-gray-200 p-6 shadow-sm",children:[t.jsxs("h3",{className:"text-lg font-semibold text-gray-900 mb-4",children:["Top Institutions by Student Count",l!=="all"&&` (${h[l]?.shortName})`]}),t.jsx("div",{className:"h-96",children:t.jsx(m,{width:"100%",height:"100%",children:t.jsxs(g,{data:o.topInstitutions,children:[t.jsx(j,{strokeDasharray:"3 3"}),t.jsx(y,{dataKey:"institution",angle:-45,textAnchor:"end",height:120,fontSize:9}),t.jsx(b,{}),t.jsx(p,{content:({active:i,payload:s,label:d})=>i&&s&&s.length?t.jsxs("div",{className:"bg-white p-3 border border-gray-200 rounded-lg shadow-lg max-w-sm",children:[t.jsx("p",{className:"font-medium text-gray-900 text-sm",children:d}),t.jsxs("p",{className:"text-sm text-gray-600",children:["Students: ",s[0].value]})]}):null}),t.jsx(v,{dataKey:"count",fill:"#059669"})]})})}),t.jsx("p",{className:"text-sm text-gray-600 mt-2",children:"Top 15 institutions by student participation across all workshops."})]}),t.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[t.jsx("div",{className:"bg-white rounded-lg border border-gray-200 p-4 shadow-sm",children:t.jsxs("div",{className:"text-center",children:[t.jsx("div",{className:"text-2xl font-bold text-blue-600",children:o.topCountries.length}),t.jsx("div",{className:"text-sm text-gray-600",children:"Countries Shown"}),t.jsxs("div",{className:"text-xs text-gray-500 mt-1",children:["(Top ",o.topCountries.length," by student count)"]})]})}),t.jsx("div",{className:"bg-white rounded-lg border border-gray-200 p-4 shadow-sm",children:t.jsxs("div",{className:"text-center",children:[t.jsx("div",{className:"text-2xl font-bold text-purple-600",children:r?o.institutionStats.length:o.topInstitutions.length}),t.jsx("div",{className:"text-sm text-gray-600",children:r?"Institutions in Country":"Top Institutions"}),t.jsx("div",{className:"text-xs text-gray-500 mt-1",children:r?`(in ${r})`:"(globally)"})]})}),t.jsx("div",{className:"bg-white rounded-lg border border-gray-200 p-4 shadow-sm",children:t.jsxs("div",{className:"text-center",children:[t.jsxs("div",{className:"text-2xl font-bold text-green-600",children:[(o.topCountries.reduce((i,s)=>i+parseFloat(s.diversity),0)/o.topCountries.length).toFixed(1),"%"]}),t.jsx("div",{className:"text-sm text-gray-600",children:"Avg. Institutional Diversity"}),t.jsx("div",{className:"text-xs text-gray-500 mt-1",children:"(institutions per student ratio)"})]})})]})]})};export{A as DrilldownAnalytics};
